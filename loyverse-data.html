<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loyverse Data Explorer - Modifiers, Variants & More</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px; 
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    h1 { 
      text-align: center; 
      color: #333; 
      margin-bottom: 30px;
      font-size: 2.5em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .nav-tabs {
      display: flex;
      background: #f8f9fa;
      border-radius: 10px;
      padding: 5px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .nav-tab {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      min-width: 120px;
      text-align: center;
    }

    .nav-tab.active {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .nav-tab:hover:not(.active) {
      background: #e9ecef;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .data-section {
      margin-bottom: 40px;
    }

    .data-section h2 { 
      background: linear-gradient(45deg, #667eea, #764ba2); 
      color: white; 
      padding: 15px 20px; 
      border-radius: 10px; 
      margin-bottom: 20px;
      font-size: 1.5em;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .data-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .data-card {
      border: 1px solid #e0e0e0; 
      padding: 20px; 
      border-radius: 12px; 
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .data-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .data-card h3 { 
      margin: 0 0 10px 0; 
      color: #333;
      font-size: 1.3em;
      border-bottom: 2px solid #667eea;
      padding-bottom: 8px;
    }

    .data-card p {
      color: #666;
      margin: 8px 0;
      line-height: 1.5;
    }

    .price {
      color: #667eea;
      font-weight: bold;
      font-size: 1.1em;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 500;
      margin: 2px;
    }

    .badge-primary {
      background: #667eea;
      color: white;
    }

    .badge-success {
      background: #28a745;
      color: white;
    }

    .badge-warning {
      background: #ffc107;
      color: #212529;
    }

    .badge-info {
      background: #17a2b8;
      color: white;
    }

    .loading {
      text-align: center;
      font-size: 1.2em;
      color: #666;
      padding: 40px;
    }

    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      border: 1px solid #f5c6cb;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .stat-number {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    .modifier-group {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      border-left: 4px solid #667eea;
    }

    .modifier-item {
      background: white;
      border-radius: 6px;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #e9ecef;
    }

    .variant-item {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 10px;
      margin: 5px 0;
      border-left: 3px solid #28a745;
    }

    .store-info {
      background: #e3f2fd;
      border-radius: 6px;
      padding: 8px;
      margin: 5px 0;
      font-size: 0.9em;
    }
    
    .item-image {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      flex-shrink: 0;
    }
    
    .item-no-image {
      width: 100px;
      height: 100px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #999;
      font-size: 0.8em;
      flex-shrink: 0;
    }
    
    .item-content {
      display: flex;
      gap: 15px;
      align-items: flex-start;
    }
    
    .item-details {
      flex: 1;
      min-width: 0;
    }

    @media (max-width: 768px) {
      .nav-tabs {
        flex-direction: column;
      }
      
      .nav-tab {
        min-width: auto;
      }
      
      .data-grid {
        grid-template-columns: 1fr;
      }
      
             .stats-grid {
         grid-template-columns: repeat(2, 1fr);
       }
       
       .item-content {
         flex-direction: column;
         gap: 10px;
       }
       
       .item-image, .item-no-image {
         width: 100%;
         height: 150px;
         align-self: center;
       }
     }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Loyverse Data Explorer</h1>
    
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
      <button class="nav-tab" onclick="showTab('modifiers')">Modifiers</button>
      <button class="nav-tab" onclick="showTab('variants')">Variants</button>
      <button class="nav-tab" onclick="showTab('items')">Items</button>
      <button class="nav-tab" onclick="showTab('categories')">Categories</button>
      <button class="nav-tab" onclick="showTab('stores')">Stores</button>
      <button class="nav-tab" onclick="showTab('taxes')">Taxes</button>
    </div>

    <!-- Overview Tab -->
    <div id="overview" class="tab-content active">
      <div class="data-section">
        <h2>üìä Data Overview</h2>
        <div id="stats" class="stats-grid">
          <div class="loading">Loading statistics...</div>
        </div>
      </div>
      
      <div class="data-section">
        <h2>üîÑ Recent Activity</h2>
        <div id="activity" class="loading">Loading activity data...</div>
      </div>
    </div>

    <!-- Modifiers Tab -->
    <div id="modifiers" class="tab-content">
      <div class="data-section">
        <h2>‚ûï Modifiers</h2>
        <div id="modifiers-content" class="loading">Loading modifiers...</div>
      </div>
      
      <div class="data-section">
        <h2>üìã Modifier Groups</h2>
        <div id="modifier-groups-content" class="loading">Loading modifier groups...</div>
      </div>
    </div>

    <!-- Variants Tab -->
    <div id="variants" class="tab-content">
      <div class="data-section">
        <h2>üìè Items with Variants</h2>
        <div id="variants-content" class="loading">Loading variants...</div>
      </div>
    </div>

    <!-- Items Tab -->
    <div id="items" class="tab-content">
      <div class="data-section">
        <h2>üçΩÔ∏è All Items</h2>
        <div id="items-content" class="loading">Loading items...</div>
      </div>
    </div>

    <!-- Categories Tab -->
    <div id="categories" class="tab-content">
      <div class="data-section">
        <h2>üìÇ Categories</h2>
        <div id="categories-content" class="loading">Loading categories...</div>
      </div>
    </div>

    <!-- Stores Tab -->
    <div id="stores" class="tab-content">
      <div class="data-section">
        <h2>üè™ Stores</h2>
        <div id="stores-content" class="loading">Loading stores...</div>
      </div>
    </div>

    <!-- Taxes Tab -->
    <div id="taxes" class="tab-content">
      <div class="data-section">
        <h2>üí∞ Taxes</h2>
        <div id="taxes-content" class="loading">Loading taxes...</div>
      </div>
    </div>
  </div>

  <script>
    let loyverseData = null;

    // Tab switching functionality
    function showTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content
      document.getElementById(tabName).classList.add('active');
      
      // Add active class to clicked tab
      event.target.classList.add('active');
      
      // Load data for the tab if not already loaded
      if (loyverseData && tabName !== 'overview') {
        loadTabData(tabName);
      }
    }

    // Fetch data from Loyverse API
    async function fetchLoyverseData() {
      try {
        console.log('Fetching comprehensive Loyverse data...');
        const response = await fetch('/api/data');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('Loyverse data received:', data);
        
        loyverseData = data;
        
        // Load overview data
        loadOverviewData();
        
        // Pre-load all tab data
        loadTabData('modifiers');
        loadTabData('variants');
        loadTabData('items');
        loadTabData('categories');
        loadTabData('stores');
        loadTabData('taxes');
        
      } catch (error) {
        console.error('Error fetching Loyverse data:', error);
        document.querySelector('.container').innerHTML = `
          <div class="error">
            <h3>Error loading data</h3>
            <p>${error.message}</p>
            <p>Please check the console for more details.</p>
          </div>
        `;
      }
    }

    // Load overview data
    function loadOverviewData() {
      const stats = document.getElementById('stats');
      const activity = document.getElementById('activity');
      
      if (!loyverseData) return;
      
             // Calculate statistics
       const itemCount = loyverseData.items?.items?.length || 0;
       const categoryCount = loyverseData.categories?.categories?.length || 0;
       const modifierCount = loyverseData.modifiers?.modifiers?.length || 0;
       const storeCount = loyverseData.stores?.stores?.length || 0;
       const taxCount = loyverseData.taxes?.taxes?.length || 0;
      
      const itemsWithVariants = loyverseData.items?.items?.filter(item => 
        item.variants && item.variants.length > 1
      ).length || 0;
      
      // Update stats
      stats.innerHTML = `
        <div class="stat-card">
          <div class="stat-number">${itemCount}</div>
          <div class="stat-label">Total Items</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${categoryCount}</div>
          <div class="stat-label">Categories</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${modifierCount}</div>
          <div class="stat-label">Modifiers</div>
        </div>
                 <div class="stat-card">
           <div class="stat-number">${modifierCount}</div>
           <div class="stat-label">Modifiers</div>
         </div>
        <div class="stat-card">
          <div class="stat-number">${itemsWithVariants}</div>
          <div class="stat-label">Items with Variants</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${storeCount}</div>
          <div class="stat-label">Stores</div>
        </div>
      `;
      
      // Show any errors
      if (loyverseData.errors && loyverseData.errors.length > 0) {
        activity.innerHTML = `
          <div class="error">
            <h3>API Errors</h3>
            ${loyverseData.errors.map(error => `
              <p><strong>${error.endpoint}:</strong> ${error.error}</p>
            `).join('')}
          </div>
        `;
      } else {
        activity.innerHTML = `
          <div class="data-card">
            <h3>‚úÖ All Data Loaded Successfully</h3>
            <p>All Loyverse data has been fetched and is ready for exploration.</p>
            <p>Use the tabs above to navigate through different data types.</p>
          </div>
        `;
      }
    }

    // Load data for specific tabs
    function loadTabData(tabName) {
      if (!loyverseData) return;
      
      switch(tabName) {
        case 'modifiers':
          loadModifiersData();
          break;
        case 'variants':
          loadVariantsData();
          break;
        case 'items':
          loadItemsData();
          break;
        case 'categories':
          loadCategoriesData();
          break;
        case 'stores':
          loadStoresData();
          break;
        case 'taxes':
          loadTaxesData();
          break;
      }
    }

         // Load modifiers data
     function loadModifiersData() {
       const content = document.getElementById('modifiers-content');
       const modifiers = loyverseData.modifiers?.modifiers || [];
       
       if (modifiers.length === 0) {
         content.innerHTML = '<div class="data-card"><p>No modifiers found.</p></div>';
         return;
       }
       
       content.innerHTML = `
         <div class="data-grid">
           ${modifiers.map(modifier => `
             <div class="data-card">
               <h3>${modifier.name || 'Unnamed Modifier'}</h3>
               <p><strong>ID:</strong> ${modifier.id}</p>
               <p><strong>Position:</strong> ${modifier.position || 'N/A'}</p>
               <p><strong>Created:</strong> ${new Date(modifier.created_at).toLocaleDateString()}</p>
               ${modifier.modifier_options && modifier.modifier_options.length > 0 ? `
                 <div class="modifier-group">
                   <strong>Options:</strong>
                   ${modifier.modifier_options.map(option => `
                     <div class="modifier-item">
                       ${option.name} - $${parseFloat(option.price || 0).toFixed(2)}
                     </div>
                   `).join('')}
                 </div>
               ` : ''}
             </div>
           `).join('')}
         </div>
       `;
       
       // Load modifier groups (using the same data since groups are the modifiers themselves)
       const groupsContent = document.getElementById('modifier-groups-content');
       
       if (modifiers.length === 0) {
         groupsContent.innerHTML = '<div class="data-card"><p>No modifier groups found.</p></div>';
         return;
       }
       
       groupsContent.innerHTML = `
         <div class="data-grid">
           ${modifiers.map(modifier => `
             <div class="data-card">
               <h3>${modifier.name || 'Unnamed Group'}</h3>
               <p><strong>ID:</strong> ${modifier.id}</p>
               <p><strong>Position:</strong> ${modifier.position || 'N/A'}</p>
               <p><strong>Options in group:</strong> ${modifier.modifier_options?.length || 0}</p>
               <p><strong>Created:</strong> ${new Date(modifier.created_at).toLocaleDateString()}</p>
               ${modifier.modifier_options && modifier.modifier_options.length > 0 ? `
                 <div class="modifier-group">
                   <strong>Options:</strong>
                   ${modifier.modifier_options.map(option => `
                     <div class="modifier-item">
                       ${option.name} - $${parseFloat(option.price || 0).toFixed(2)}
                     </div>
                   `).join('')}
                 </div>
               ` : ''}
             </div>
           `).join('')}
         </div>
       `;
     }

    // Load variants data
    function loadVariantsData() {
      const content = document.getElementById('variants-content');
      const items = loyverseData.items?.items || [];
      const itemsWithVariants = items.filter(item => item.variants && item.variants.length > 1);
      
      if (itemsWithVariants.length === 0) {
        content.innerHTML = '<div class="data-card"><p>No items with variants found.</p></div>';
        return;
      }
      
             content.innerHTML = `
         <div class="data-grid">
           ${itemsWithVariants.map(item => `
             <div class="data-card">
               <div class="item-content">
                 ${item.image_url ? `<img src="${item.image_url}" alt="${item.item_name}" class="item-image">` : '<div class="item-no-image">No Image</div>'}
                 <div class="item-details">
                   <h3>${item.item_name || 'Unnamed Item'}</h3>
                   <p><strong>Category:</strong> ${getCategoryName(item.category_id)}</p>
                   <p><strong>Variants:</strong> ${item.variants.length}</p>
                   ${item.description ? `<p><strong>Description:</strong> ${item.description.replace(/<[^>]*>/g, '')}</p>` : ''}
                   <div class="modifier-group">
                     <strong>Variants:</strong>
                     ${item.variants.map(variant => `
                       <div class="variant-item">
                         <strong>${variant.variant_name || 'Default'}</strong>
                         ${variant.stores && variant.stores.length > 0 ? `
                           <div class="store-info">
                             Price: $${parseFloat(variant.stores[0].price || 0).toFixed(2)}
                           </div>
                         ` : ''}
                       </div>
                     `).join('')}
                   </div>
                 </div>
               </div>
             </div>
           `).join('')}
         </div>
       `;
    }

    // Load items data
    function loadItemsData() {
      const content = document.getElementById('items-content');
      const items = loyverseData.items?.items || [];
      
      if (items.length === 0) {
        content.innerHTML = '<div class="data-card"><p>No items found.</p></div>';
        return;
      }
      
      content.innerHTML = `
        <div class="data-grid">
          ${items.map(item => {
            const price = getItemPrice(item);
            const hasVariants = item.variants && item.variants.length > 1;
            const hasModifiers = item.modifier_ids && item.modifier_ids.length > 0;
            
                         return `
               <div class="data-card">
                 <div class="item-content">
                   ${item.image_url ? `<img src="${item.image_url}" alt="${item.item_name}" class="item-image">` : '<div class="item-no-image">No Image</div>'}
                   <div class="item-details">
                     <h3>${item.item_name || 'Unnamed Item'}</h3>
                     <p><strong>Category:</strong> ${getCategoryName(item.category_id)}</p>
                     <p><strong>Price:</strong> <span class="price">$${price.toFixed(2)}</span></p>
                     <p><strong>Created:</strong> ${new Date(item.created_at).toLocaleDateString()}</p>
                     ${item.description ? `<p><strong>Description:</strong> ${item.description.replace(/<[^>]*>/g, '')}</p>` : ''}
                     <div style="margin-top: 10px;">
                       ${hasVariants ? `<span class="badge badge-success">${item.variants.length} Variants</span>` : ''}
                       ${hasModifiers ? `<span class="badge badge-info">${item.modifier_ids.length} Modifiers</span>` : ''}
                       ${item.track_stock ? '<span class="badge badge-warning">Stock Tracked</span>' : ''}
                     </div>
                   </div>
                 </div>
               </div>
             `;
          }).join('')}
        </div>
      `;
    }

    // Load categories data
    function loadCategoriesData() {
      const content = document.getElementById('categories-content');
      const categories = loyverseData.categories?.categories || [];
      
      if (categories.length === 0) {
        content.innerHTML = '<div class="data-card"><p>No categories found.</p></div>';
        return;
      }
      
      content.innerHTML = `
        <div class="data-grid">
          ${categories.map(category => {
            const itemsInCategory = loyverseData.items?.items?.filter(item => 
              item.category_id === category.id
            ).length || 0;
            
            return `
              <div class="data-card">
                <h3>${category.name || 'Unnamed Category'}</h3>
                <p><strong>ID:</strong> ${category.id}</p>
                <p><strong>Items in category:</strong> ${itemsInCategory}</p>
                <p><strong>Created:</strong> ${new Date(category.created_at).toLocaleDateString()}</p>
                ${category.description ? `<p><strong>Description:</strong> ${category.description}</p>` : ''}
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    // Load stores data
    function loadStoresData() {
      const content = document.getElementById('stores-content');
      const stores = loyverseData.stores?.stores || [];
      
      if (stores.length === 0) {
        content.innerHTML = '<div class="data-card"><p>No stores found.</p></div>';
        return;
      }
      
      content.innerHTML = `
        <div class="data-grid">
          ${stores.map(store => `
            <div class="data-card">
              <h3>${store.name || 'Unnamed Store'}</h3>
              <p><strong>ID:</strong> ${store.id}</p>
              <p><strong>Address:</strong> ${store.address || 'No address'}</p>
              <p><strong>Phone:</strong> ${store.phone || 'No phone'}</p>
              <p><strong>Email:</strong> ${store.email || 'No email'}</p>
              <p><strong>Created:</strong> ${new Date(store.created_at).toLocaleDateString()}</p>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Load taxes data
    function loadTaxesData() {
      const content = document.getElementById('taxes-content');
      const taxes = loyverseData.taxes?.taxes || [];
      
      if (taxes.length === 0) {
        content.innerHTML = '<div class="data-card"><p>No taxes found.</p></div>';
        return;
      }
      
      content.innerHTML = `
        <div class="data-grid">
          ${taxes.map(tax => `
            <div class="data-card">
              <h3>${tax.name || 'Unnamed Tax'}</h3>
              <p><strong>ID:</strong> ${tax.id}</p>
              <p><strong>Rate:</strong> ${parseFloat(tax.rate || 0).toFixed(2)}%</p>
              <p><strong>Created:</strong> ${new Date(tax.created_at).toLocaleDateString()}</p>
            </div>
          `).join('')}
        </div>
      `;
    }

    // Helper functions
    function getCategoryName(categoryId) {
      if (!categoryId || !loyverseData.categories?.categories) return 'Uncategorized';
      const category = loyverseData.categories.categories.find(c => c.id === categoryId);
      return category ? category.name : 'Uncategorized';
    }

    function getItemPrice(item) {
      // Check direct price fields first
      if (item.price !== undefined && item.price !== null) {
        return parseFloat(item.price) || 0;
      }
      if (item.retail_price !== undefined && item.retail_price !== null) {
        return parseFloat(item.retail_price) || 0;
      }
      if (item.sale_price !== undefined && item.sale_price !== null) {
        return parseFloat(item.sale_price) || 0;
      }
      if (item.base_price !== undefined && item.base_price !== null) {
        return parseFloat(item.base_price) || 0;
      }
      
      // Check variants for store prices
      if (item.variants && item.variants.length > 0) {
        const firstVariant = item.variants[0];
        if (firstVariant.stores && firstVariant.stores.length > 0) {
          return parseFloat(firstVariant.stores[0].price) || 0;
        }
      }
      
      return 0;
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      fetchLoyverseData();
    });
  </script>
</body>
</html>
